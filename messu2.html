<!DOCTYPE html>
<html lang="tr" data-theme="olympus">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PANTEON'UN KADERƒ∞ v4.2 | Nƒ∞HAƒ∞ S√ñZLE≈ûME</title>
    
    <!-- Mitolojik ve Teknik Fontlar Birle≈ütirildi -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Gerekli K√ºt√ºphaneler -->
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
</head>
<body>
    <!-- G√∂rsel Efektler i√ßin Zemin (Madde 2) -->
    <div id="particles-container"></div>

    <!-- √úst Bilgi ≈ûeridi (v2.0 G√∂r√ºn√ºm√º) -->
    <div id="super-top-ticker">
        <div class="super-top-left">
            <span id="ticker-bar-symbol">BTC/USDT</span>
            <span id="ticker-bar-price">-</span>
        </div>
        <div class="super-top-right-buttons desktop-only">
            <button id="main-controls-btn" class="btn btn-tiny">Panteon</button>
            <button id="chart-view-btn" class="btn btn-tiny">Kader Haritasƒ±</button>
            <button id="heatmap-view-btn" class="btn btn-tiny">Alev Denizi</button>
            <button id="fullscreen-chart-btn" class="btn btn-tiny">Tam Ekran</button>
            <button id="honor-board-btn" class="btn btn-tiny">≈ûeref Tablosu</button>
            <button id="banned-board-btn" class="btn btn-tiny">Zindan</button>
            <button id="open-settings-modal-btn" class="btn btn-tiny btn-primary">Kutsal Kitap</button>
        </div>
        <div class="super-top-right-buttons mobile-only">
            <button id="mobile-fullscreen-chart-btn" class="btn btn-tiny">Tam Ekran</button>
            <button id="mobile-open-log-modal-btn" class="btn btn-tiny">üìú G√ºnl√ºk</button>
            <button id="mobile-open-settings-modal-btn" class="btn btn-tiny btn-primary">Kitap</button>
        </div>
    </div>

    <!-- Sinyal G√ºc√º Barƒ± (v2.0'dan) -->
    <div id="signal-progress-bar-container">
        <div class="signal-bar-wrapper">
            <div class="signal-bar-label">Y√úKSELƒ∞≈û (BUY) UYUMU</div>
            <div class="signal-bar"><div id="buy-signal-bar-fill" class="signal-bar-fill buy"></div></div>
            <div id="buy-signal-score-text" class="signal-score-text">0.0</div>
        </div>
        <div class="signal-bar-wrapper">
            <div class="signal-bar-label">D√ú≈û√ú≈û (SELL) UYUMU</div>
            <div class="signal-bar"><div id="sell-signal-bar-fill" class="signal-bar-fill sell"></div></div>
            <div id="sell-signal-score-text" class="signal-score-text">0.0</div>
        </div>
    </div>

    <!-- Ana Konteyner -->
    <div class="container">
        <!-- Komuta Merkezi Ba≈ülƒ±ƒüƒ± (v2.0 G√∂r√ºn√ºm√º, v3.2 Temasƒ±) -->
        <header class="header">
            <div id="header-main-bar" class="header-top-bar">
                <div class="header-left-controls">
                    <button id="mobile-toggle-controls-btn" class="btn btn-tiny mobile-only" title="Kontrolleri A√ß/Kapat">‚ò∞</button>
                </div>
                <div class="header-center-title" title="Paneli a√ß/kapatmak i√ßin √ßift tƒ±kla">
                    <span class="header-title-text">‚ö° PANTEON KONTROLLERƒ∞ ‚ö°</span>
                </div>
                <div class="header-right-controls">
                    <button id="mobile-chart-view-btn" class="btn btn-tiny mobile-only" title="Kader Haritasƒ±">üìà</button>
                    <button id="mobile-heatmap-view-btn" class="btn btn-tiny mobile-only" title="Alev Denizi">üî•</button>
                    <button id="mobile-honor-board-btn" class="btn btn-tiny mobile-only" title="≈ûeref Tablosu">üèÜ</button>
                    <button id="mobile-banned-board-btn" class="btn btn-tiny mobile-only" title="Zindan">‚õìÔ∏è</button>
                </div>
            </div>
            <div class="header-collapsible-content">
                <div class="main-controls">
                    <input type="text" id="symbol-input" class="form-control" placeholder="Sembol (BTC, ETH)">
                    <select id="timeframe-select" class="form-control">
                        <option value="1m">1m</option><option value="5m">5m</option><option value="15m" selected>15m</option><option value="1h">1h</option><option value="4h">4h</option>
                    </select>
                    <div class="status">
                        <div id="connection-status" class="status-dot"></div>
                        <span id="connection-text">BAƒûLANTI YOK</span>
                    </div>
                    <button id="theme-toggle-btn" class="btn">Tema</button>
                    <button id="start-btn" class="btn btn-success">Kaderi Ba≈ülat</button>
                    <button id="stop-btn" class="btn btn-danger" disabled>Durdur</button>
                    <button id="clear-markers-btn" class="btn">ƒ∞≈üaretleri Sil</button> 
                </div>
                <div class="price-display">
                    <div class="price-item"><div class="price-label">ANLIK Fƒ∞YAT</div><div class="price-value" id="current-price">-</div></div>
                    <div class="price-item"><div class="price-label">24s DEƒûƒ∞≈ûƒ∞M</div><div class="price-value" id="price-change-24h">-</div></div>
                    <div class="price-item"><div class="price-label">24s HACƒ∞M</div><div class="price-value" id="volume-24h">-</div></div>
                    <div class="price-item"><div class="price-label">VOLATƒ∞Lƒ∞TE (ATR)</div><div class="price-value" id="atr-value">-</div></div>
                    <div class="price-item countdown"><span id="candle-countdown">--:--</span></div>
                </div>
            </div>
        </header>

        <!-- Ana Yerle≈üim Grid'i -->
        <main class="main-grid">
            <!-- Orta Panel: Grafik ve Isƒ± Haritasƒ± -->
            <section class="center-panel panel">
                <div class="data-container">
                    <div class="data-grid" id="chart-container-view">
                        <div id="live-chart"></div>
                        <div class="chart-zoom-controls"> 
                            <button id="chart-zoom-in" class="btn btn-tiny">+</button>
                            <button id="chart-zoom-out" class="btn btn-tiny">-</button>
                            <button id="chart-zoom-reset" class="btn btn-tiny">Sƒ±fƒ±rla</button>
                        </div>
                        <button id="exit-fullscreen-btn" class="btn btn-tiny hidden-view" title="Tam Ekrandan √áƒ±k">&times;</button>
                        <div id="chart-countdown-overlay" class="hidden-view">--:--</div>
                    </div>
                    <div class="heatmap-container hidden-view" id="heatmap-container-view">
                        <div class="panel-title" style="border-top: 1px solid var(--border-color); border-bottom: none;">ALEV DENƒ∞Zƒ∞ (EMƒ∞R DEFTERƒ∞)</div>
                        <canvas id="orderbook-heatmap"></canvas>
                    </div>
                </div>
                <div class="resize-handle"></div>
            </section>
        </main>
    </div>
    
    <!-- Panteon ve Kehanet Panelleri (Madde 3) -->
    <aside id="panteon-panel" class="panel">
        <div class="panel-title">PANTEON</div>
        <div class="panel-content">
            <!-- El√ßiler buraya gelecek -->
        </div>
    </aside>
    <aside id="kehanet-panel" class="panel">
        <div class="panel-title">ZEUS'UN FISILTILARI</div>
        <div class="panel-content">
            <!-- Kehanet butonlarƒ± buraya gelecek -->
        </div>
    </aside>

    <!-- Bildirimler i√ßin Konteyner -->
    <div id="notifications-container" class="notifications"></div>

    <!-- Ayarlar Modalƒ± (Kutsal Kitap) -->
    <div id="settings-modal-overlay">
        <div class="settings-modal-content">
            <div class="settings-modal-header">
                <h2 class="settings-modal-title">üìú KUTSAL Kƒ∞TAP üìú</h2>
                <button class="close-btn" id="close-settings-modal-btn">&times;</button>
            </div>
            <div class="settings-modal-body">
                <!-- Ayar gruplarƒ± buraya gelecek -->
            </div>
            <div class="settings-modal-footer">
                <button id="reset-universe-btn" class="btn btn-danger">Evreni Sƒ±fƒ±rla</button>
                <button id="save-settings-btn" class="btn btn-primary">Kaderi M√ºh√ºrle</button>
            </div>
        </div>
    </div>

    <!-- Sistem G√ºnl√ºƒü√º (Log) Modalƒ± -->
    <div id="log-modal-overlay">
        <div class="log-modal-content">
            <div class="log-modal-header">
                <span>Sƒ∞STEM G√úNL√úƒû√ú</span>
                <div>
                    <button id="export-logs-btn" class="btn btn-sm btn-success">G√ºnl√ºƒü√º Aktar</button>
                    <button class="close-btn" id="close-log-modal-btn">&times;</button>
                </div>
            </div>
            <div class="log-modal-body">
                <pre id="log-output"></pre>
            </div>
        </div>
    </div>

    <!-- ≈ûeref/Zindan Tablosu Modalƒ± -->
    <div id="honor-modal-overlay">
      <div class="honor-modal-content">
        <div class="honor-modal-header">
          <div id="honor-modal-title" class="panel-title">≈ûeref Tablosu</div>
          <button id="close-honor-modal" class="btn btn-tiny">Kapat</button>
        </div>
        <div id="honor-modal-body" class="panel-content"></div>
      </div>
    </div>
    <!-- √ñnceki HTML ƒ∞skeleti Burada Bitiyor -->

    <style>
        /* ===============================================
           TEMA v4.2 - Nƒ∞HAƒ∞ S√ñZLE≈ûME STƒ∞Lƒ∞
           =============================================== */
        :root {
            /* Mitolojik Tema Renkleri ve Fontlarƒ± (v3.2'den) */
            --font-divine: 'Cinzel', serif;
            --font-primary: 'Orbitron', sans-serif;
            --font-secondary: 'Roboto Mono', monospace;
            
            --olympus-bg: linear-gradient(145deg, #0a0a1f 0%, #1a1a3e 100%);
            --olympus-panel-bg: rgba(20, 20, 40, 0.85);
            --olympus-text-main: #e8e8ff;
            --olympus-text-secondary: #a8a8ff;
            --olympus-border: rgba(100, 100, 200, 0.3);
            --olympus-input-bg: rgba(10, 10, 31, 0.7);
            --olympus-hover-bg: rgba(30, 30, 60, 1);
            --olympus-primary: #ffd700;

            /* Genel Renkler */
            --positive: #00ff88;
            --negative: #ff3366;
            --neutral: #ffaa00;
            --info: #00aaff;

            /* I≈üƒ±ma Efektleri (v3.2'den) */
            --glow-primary: 0 0 25px rgba(255, 215, 0, 0.6);
            --glow-success: 0 0 15px rgba(0, 255, 136, 0.5);
            --glow-danger: 0 0 15px rgba(255, 51, 102, 0.5);
            
            /* Yerle≈üim Deƒüi≈ükenleri (v2.0'dan) */
            --ticker-height: 35px;
            --signal-bar-height: 40px;
            --header-min-height: 50px;
        }

        [data-theme="olympus"] { --background: var(--olympus-bg); --panel-bg: var(--olympus-panel-bg); --text-main: var(--olympus-text-main); --text-secondary: var(--olympus-text-secondary); --border-color: var(--olympus-border); --input-bg: var(--olympus-input-bg); --hover-bg: var(--olympus-hover-bg); --primary: var(--olympus-primary); }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-secondary); font-size: 12px; background: var(--background); color: var(--text-main); overflow: hidden; transition: background 0.5s, color 0.5s; }
        
        #particles-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }

        #super-top-ticker { display: flex; position: fixed; top: 0; left: 0; width: 100%; background: var(--panel-bg); border-bottom: 1px solid var(--border-color); padding: 5px 15px; z-index: 1100; align-items: center; justify-content: space-between; font-size: 12px; height: var(--ticker-height); backdrop-filter: blur(8px); }
        .super-top-left { display: flex; align-items: center; gap: 15px; }
        #ticker-bar-symbol { font-family: var(--font-primary); color: var(--primary); font-size: 14px; text-shadow: var(--glow-primary); }
        #ticker-bar-price { font-size: 16px; font-weight: 700; }
        
        .container { display: flex; flex-direction: column; height: 100vh; padding-top: calc(var(--ticker-height) + var(--signal-bar-height)); }

        .header { background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 8px; flex-shrink: 0; box-shadow: 0 4px 20px rgba(0,0,0,0.3); margin: 10px; position: relative; backdrop-filter: blur(8px); }
        .header-top-bar { display: flex; align-items: center; justify-content: center; width: 100%; padding: 8px; min-height: var(--header-min-height); cursor: pointer; font-family: var(--font-divine); font-size: 24px; font-weight: 900; color: var(--primary); text-shadow: var(--glow-primary); letter-spacing: 3px; }
        .header-collapsible-content { transition: max-height 0.4s ease-in-out, opacity 0.4s ease, padding 0.4s ease; max-height: 500px; opacity: 1; overflow: hidden; padding: 0 15px 15px 15px; }
        body.header-collapsed .header-collapsible-content { max-height: 0; opacity: 0; padding-top: 0; padding-bottom: 0; }

        .main-controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center; padding-bottom: 15px; }
        .form-control { background: var(--input-bg); color: var(--text-main); border: 1px solid var(--border-color); border-radius: 6px; padding: 8px 12px; font-family: var(--font-secondary); }
        .form-control:focus { outline: none; border-color: var(--info); box-shadow: 0 0 10px rgba(0, 170, 255, 0.3); }
        
        .status { display: flex; align-items: center; gap: 8px; font-size: 12px; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--negative); transition: background-color 0.5s; }
        .status-dot.online { background: var(--positive); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 var(--positive); } 70% { box-shadow: 0 0 0 8px rgba(0, 255, 136, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); } }
        
        .btn { padding: 8px 18px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-main); border-radius: 6px; cursor: pointer; transition: all 0.2s; font-family: var(--font-primary); text-transform: uppercase; letter-spacing: 1px; }
        .btn:hover { background: var(--hover-bg); border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }
        .btn-success { background: var(--positive); color: #000; border-color: var(--positive); box-shadow: var(--glow-success); }
        .btn-danger { background: var(--negative); color: #fff; border-color: var(--negative); box-shadow: var(--glow-danger); }
        .btn-primary { background: var(--primary); color: #000; border-color: var(--primary); box-shadow: var(--glow-primary); }
        .btn-tiny { padding: 4px 10px; font-size: 11px; }

        .main-grid { display: grid; grid-template-columns: 280px 1fr 280px; gap: 10px; flex-grow: 1; margin: 0 10px 10px 10px; overflow: hidden; height: calc(100% - var(--header-min-height) - 20px); }
        body.header-collapsed .main-grid { height: calc(100% - 20px); }
        
        .panel { display: flex; flex-direction: column; background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; backdrop-filter: blur(8px); box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .panel-title { font-family: var(--font-divine); font-weight: 700; font-size: 16px; color: var(--primary); padding: 12px; border-bottom: 1px solid var(--border-color); flex-shrink: 0; text-align: center; letter-spacing: 1px; text-shadow: var(--glow-primary); }
        .panel-content { padding: 10px; overflow-y: auto; flex-grow: 1; }
        
        .chart-container { position: relative; height: 100%; width: 100%; }
        #live-chart { width: 100%; height: 100%; }
        #chart-countdown { position: absolute; top: 10px; left: 10px; z-index: 100; background: rgba(22, 27, 34, 0.7); padding: 5px 10px; border-radius: 4px; font-weight: 700; color: var(--primary); }

        .notifications { position: fixed; bottom: 10px; left: 10px; z-index: 2000; width: 320px; }
        .notification { background: var(--panel-bg); border: 1px solid var(--border-color); border-left-width: 4px; border-radius: 6px; padding: 15px; font-size: 13px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); margin-top: 10px; animation: slideInLeft 0.4s ease-out; backdrop-filter: blur(5px); }
        @keyframes slideInLeft { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .notification.success { border-left-color: var(--positive); }
        .notification.danger { border-left-color: var(--negative); }
        .notification.warning { border-left-color: var(--neutral); }
        .notification.divine { border-left-color: var(--primary); box-shadow: var(--glow-primary); }
        .notification-title { font-family: var(--font-primary); font-weight: 700; margin-bottom: 5px; }

        #settings-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 2500; }
        #settings-modal-overlay.visible { display: flex; }
        .settings-modal-content { background: var(--panel-bg); border: 1px solid var(--primary); border-radius: 12px; width: 90%; max-width: 1000px; max-height: 90vh; display: flex; flex-direction: column; box-shadow: var(--glow-primary); }
        .settings-modal-header { padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .settings-modal-title { font-family: var(--font-divine); font-size: 20px; color: var(--primary); }
        .close-btn { background: none; border: none; color: var(--text-main); font-size: 24px; cursor: pointer; }
        .settings-modal-body { padding: 20px; overflow-y: auto; flex-grow: 1; }
        .settings-modal-footer { padding: 15px 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 10px; }

        @media screen and (max-width: 1024px) {
            .main-grid { grid-template-columns: 1fr; }
            #left-panel, #right-panel { display: none; }
        }
        @media screen and (max-width: 768px) {
            .main-controls { flex-direction: column; align-items: stretch; }
        }
    </style>

    <script>
    class DBManager {
        constructor() { this.dbName = 'PanteonDB_v4_Final'; this.version = 1; this.db = null; }
        async init() {
            return new Promise((resolve, reject) => {
                if (!window.indexedDB) { return reject("Tarayƒ±cƒ±nƒ±z IndexedDB'yi desteklemiyor."); }
                const request = indexedDB.open(this.dbName, this.version);
                request.onerror = (event) => reject("Veritabanƒ± hatasƒ±: " + event.target.errorCode);
                request.onsuccess = (event) => { this.db = event.target.result; console.log("Evrenin Hafƒ±zasƒ± (IndexedDB) ba≈üarƒ±yla baƒülandƒ±."); resolve(); };
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    ['settings', 'panteonState', 'strategyStats', 'signalHistory', 'notificationHistory'].forEach(name => {
                        if (!db.objectStoreNames.contains(name)) { db.createObjectStore(name, { keyPath: 'id', autoIncrement: true }); }
                    });
                };
            });
        }
    }

    class EffectsManager {
        constructor() { this.particles = null; }
        async init() {
            if (typeof tsparticles === 'undefined') { return console.error("tsparticles k√ºt√ºphanesi bulunamadƒ±."); }
            try {
                this.particles = await tsparticles.load("particles-container", { fpsLimit: 60, particles: { number: { value: 0 }, color: { value: "#ffffff" }, shape: { type: "circle" }, opacity: { value: { min: 0.5, max: 1 }, animation: { enable: true, speed: 1, destroy: "min" } }, size: { value: { min: 1, max: 3 } }, move: { enable: true, speed: 2, direction: "none", random: true, straight: false, outModes: { default: "destroy" } } }, detectRetina: true });
                console.log("Kaderin Tezah√ºr√º (G√∂rsel Efektler) motoru y√ºklendi.");
            } catch (error) { console.error("Par√ßacƒ±k motoru ba≈ülatƒ±lamadƒ±:", error); }
        }
    }

    class ChartManager {
        constructor(containerId) {
            this.container = document.getElementById(containerId);
            if (!this.container) throw new Error("Grafik konteyneri bulunamadƒ±!");
            this.chart = null; this.candleSeries = null; this.bollingerSeries = { upper: null, middle: null, lower: null };
            this._init();
        }
        _init() {
            if (typeof LightweightCharts === 'undefined') { return console.error("LightweightCharts k√ºt√ºphanesi bulunamadƒ±."); }
            const styles = getComputedStyle(document.body);
            this.chart = LightweightCharts.createChart(this.container, { width: this.container.clientWidth, height: this.container.clientHeight, layout: { backgroundColor: 'transparent', textColor: styles.getPropertyValue('--text-main').trim(), fontFamily: styles.getPropertyValue('--font-secondary'), }, grid: { vertLines: { color: styles.getPropertyValue('--border-color').trim() }, horzLines: { color: styles.getPropertyValue('--border-color').trim() } }, timeScale: { borderColor: styles.getPropertyValue('--border-color').trim(), timeVisible: true, secondsVisible: false, } });
            this.candleSeries = this.chart.addCandlestickSeries({ upColor: styles.getPropertyValue('--positive').trim(), downColor: styles.getPropertyValue('--negative').trim(), borderVisible: false, wickUpColor: styles.getPropertyValue('--positive').trim(), wickDownColor: styles.getPropertyValue('--negative').trim(), });
            const bbLineStyle = { color: 'rgba(255, 170, 0, 0.7)', lineWidth: 1, lineStyle: LightweightCharts.LineStyle.Dotted };
            this.bollingerSeries.upper = this.chart.addLineSeries(bbLineStyle); this.bollingerSeries.middle = this.chart.addLineSeries(bbLineStyle); this.bollingerSeries.lower = this.chart.addLineSeries(bbLineStyle);
            window.addEventListener('resize', () => { if (this.chart && this.container.clientWidth > 0) { this.chart.resize(this.container.clientWidth, this.container.clientHeight); } });
            console.log("Kader Haritasƒ± (Grafik Y√∂neticisi) √ßizime hazƒ±r.");
        }
    }

    class PanteonManager {
        constructor(app) { this.app = app; }
        async init() { console.log("Panteon Hiyerar≈üisi kuruldu."); }
    }

    class ConfluenceEngine {
        constructor(app) { this.app = app; }
        async init() { console.log("Uyum Motoru ba≈ülatƒ±ldƒ±."); }
    }

    class TheOracle {
        constructor(app) { this.app = app; }
        async init() { console.log("Kahin (TheOracle) g√∂zlemeye ba≈üladƒ±."); }
    }

    class UltimateTradingCommandCenter {
        constructor() {
            this.isRunning = false;
            this.dbManager = new DBManager();
            this.effectsManager = new EffectsManager();
            this.chartManager = new ChartManager('live-chart');
            this.panteonManager = new PanteonManager(this);
            this.confluenceEngine = new ConfluenceEngine(this);
            this.oracle = new TheOracle(this);
            this.init();
        }

        async init() {
            console.log("üèõÔ∏è PANTEON'UN KADERƒ∞ v4.2 BA≈ûLATILIYOR...");
            try {
                await this.dbManager.init();
                await this.effectsManager.init();
                await this.panteonManager.init();
                await this.confluenceEngine.init();
                await this.oracle.init();
                this.setupEventListeners();
                this.showNotification('Panteon Uyandƒ±', 'Sistem tanrƒ±larƒ±n emrini bekliyor.', 'divine');
            } catch (error) {
                console.error("KRƒ∞Tƒ∞K BA≈ûLATMA HATASI:", error);
                this.showNotification('Kritik Hata', 'Sistem ba≈ülatƒ±lamadƒ±. Konsolu kontrol edin.', 'danger');
            }
        }

        setupEventListeners() {
            document.getElementById('start-btn').addEventListener('click', () => this.start());
            document.getElementById('stop-btn').addEventListener('click', () => this.stop());
            document.getElementById('header-main-bar').addEventListener('click', () => {
                document.body.classList.toggle('header-collapsed');
            });
        }

        start() {
            if (this.isRunning) return;
            this.isRunning = true;
            document.getElementById('start-btn').disabled = true;
            document.getElementById('stop-btn').disabled = false;
            this.updateConnectionStatus(true);
            this.showNotification('Kader Ba≈üladƒ±', 'Tanrƒ±lar piyasalarƒ± izliyor.', 'success');
        }

        stop() {
            if (!this.isRunning) return;
            this.isRunning = false;
            document.getElementById('start-btn').disabled = false;
            document.getElementById('stop-btn').disabled = true;
            this.updateConnectionStatus(false);
            this.showNotification('Kader Durdu', 'Tanrƒ±lar dinlenmeye √ßekildi.', 'warning');
        }

        updateConnectionStatus(isConnected, text = '') {
            const statusDot = document.getElementById('connection-status');
            const statusText = document.getElementById('connection-text');
            if (statusDot && statusText) {
                statusDot.classList.toggle('online', isConnected);
                statusText.textContent = isConnected ? 'BAƒûLI' : (text || 'BAƒûLANTI YOK');
            }
        }

        showNotification(title, message, type = 'info') {
            const container = document.getElementById('notifications-container');
            if (!container) return;
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<div class="notification-title">${title}</div><div>${message}</div>`;
            container.prepend(notification);
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(-100%)';
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        window.PanteonApp = new UltimateTradingCommandCenter();
    });
        // ==================================================
    // TESLƒ∞MAT 3: MANTIK KATMANI
    // ==================================================

    class PanteonManager {
        constructor(app) {
            this.app = app;
            this.elciler = {
                metatron: { name: 'METATRON', itibar: 100, mode: 'inancli', stats: { tp: 0, sl: 0 } },
                uriel: { name: 'URIEL', itibar: 100, mode: 'inancli', stats: { tp: 0, sl: 0 } },
                raphael: { name: 'RAPHAEL', itibar: 100, mode: 'inancli', stats: { tp: 0, sl: 0 } }
            };
            this.gardiyanAssignments = {
                metatron: ['VelocityScalping', 'OrderFlowMomentum', 'MarketStructure', 'BreakoutPattern', 'SmartMoneyConcepts', 'SuperTrend', 'InstitutionalOrderFlow', 'VolumeProfile', 'CandleCharacter'],
                uriel: ['WallBounce', 'RsiDivergence', 'SupportResistance', 'FibonacciRetracement', 'DivergenceDetection', 'MicroSpreadArbitrage', 'VWAPReversion', 'BollingerReversion', 'LiquidityGaps', 'FundingRate']
            };
            this.lastActivityTime = Date.now();
            this.idleCheckInterval = null;
        }

        async init() {
            console.log("Panteon Hiyerar≈üisi kuruldu.");
        }

        startIdleCheck() {
            this.stopIdleCheck();
            this.idleCheckInterval = setInterval(() => {
                if (this.app.isRunning && (Date.now() - this.lastActivityTime) / 3600000 >= 4) {
                    Object.values(this.elciler).forEach(elci => { elci.itibar = Math.max(0, elci.itibar - 1); });
                    this.updateModes();
                    this.app.updatePanteonUI();
                    this.app.showNotification('Durgunluk Cezasƒ±', 'Panteon 4 saattir hareketsiz! T√ºm El√ßiler -1 itibar kaybetti.', 'warning');
                    this.lastActivityTime = Date.now();
                }
            }, 3600000);
        }

        stopIdleCheck() {
            if (this.idleCheckInterval) clearInterval(this.idleCheckInterval);
            this.idleCheckInterval = null;
        }

        updateReputation(signalResult, contributors) {
            const isTP = signalResult === 'tp';
            const responsibleElciler = new Set(contributors.map(c => this.findElciByGardiyan(c.strategy)).filter(Boolean));
            if (isTP) {
                responsibleElciler.forEach(elciName => { this.elciler[elciName].itibar += 1; this.elciler[elciName].stats.tp++; });
                this.elciler.raphael.itibar += 0.5;
            } else {
                Object.values(this.elciler).forEach(elci => { elci.itibar -= 2; elci.stats.sl++; });
                responsibleElciler.forEach(elciName => { this.elciler[elciName].itibar -= 3; });
            }
            this.updateModes();
            this.app.updatePanteonUI();
            this.lastActivityTime = Date.now();
        }

        updateModes() {
            Object.values(this.elciler).forEach(elci => {
                const oldMode = elci.mode;
                if (elci.itibar >= 80) elci.mode = 'inancli';
                else if (elci.itibar >= 40) elci.mode = 'supheci';
                else elci.mode = 'kiyamet';
                if (oldMode !== elci.mode) { this.app.showNotification('Mod Deƒüi≈üimi', `${elci.name} artƒ±k ${elci.mode.toUpperCase()} modunda!`, 'divine'); }
            });
        }

        findElciByGardiyan(gardiyanName) {
            for (const [elci, gardiyanList] of Object.entries(this.gardiyanAssignments)) {
                if (gardiyanList.includes(gardiyanName)) return elci;
            }
            return null;
        }

        getElciMultiplier(elciName) {
            if (!elciName || !this.elciler[elciName]) return 1;
            const mode = this.elciler[elciName].mode;
            if (mode === 'inancli') return 1.2;
            if (mode === 'supheci') return 0.9;
            if (mode === 'kiyamet') return 0.7;
            return 1;
        }
    }

    class BaseStrategy {
        constructor(app, name) { this.app = app; this.name = name; this.status = 'active'; }
        propose(direction, reason, score) {
            if (this.status !== 'active' || !this.app.isRunning) return;
            const elciName = this.app.panteonManager.findElciByGardiyan(this.name);
            const multiplier = this.app.panteonManager.getElciMultiplier(elciName);
            const finalScore = score * multiplier;
            this.app.confluenceEngine.propose(this.name, direction, reason, finalScore);
        }
    }

    class CavalryStrategy extends BaseStrategy {
        constructor(app, name) { super(app, name); this.isAwake = false; }
        awaken() {
            if (this.isAwake) return;
            this.isAwake = true;
            this.app.showNotification('S√úVARƒ∞ UYANDI', `${this.name} g√∂reve √ßaƒürƒ±ldƒ±!`, 'divine');
            setTimeout(() => {
                this.isAwake = false;
                this.app.showNotification('S√úVARƒ∞ Dƒ∞NLENƒ∞YOR', `${this.name} uykuya daldƒ±.`, 'info');
            }, 10 * 60 * 1000);
        }
        propose(direction, reason, score) { if (!this.isAwake) return; super.propose(direction, reason, score * 1.5); }
    }

    class ConfluenceEngine {
        constructor(app) { this.app = app; this.proposals = []; this.lastSignalTime = 0; }
        async init() { console.log("Uyum Motoru ba≈ülatƒ±ldƒ±."); }
        propose(strategy, direction, reason, score) {
            const now = Date.now();
            this.proposals = this.proposals.filter(p => !(p.strategy === strategy && p.direction === direction));
            this.proposals.push({ strategy, direction, reason, score, timestamp: now });
            this.proposals = this.proposals.filter(p => (now - p.timestamp) < 5000);
            this.checkConfluence();
        }
        checkConfluence() {
            if (Date.now() - this.lastSignalTime < 15000) return;
            const buyProposals = this.proposals.filter(p => p.direction === 'buy');
            const sellProposals = this.proposals.filter(p => p.direction === 'sell');
            const buyScore = buyProposals.reduce((sum, p) => sum + p.score, 0);
            const sellScore = sellProposals.reduce((sum, p) => sum + p.score, 0);
            const threshold = this.app.settings.confluenceThreshold || 3;
            const minContributors = this.app.settings.minContributors || 2;
            if (buyScore >= threshold && buyProposals.length >= minContributors && buyScore > sellScore) {
                this.generateSignal('buy', buyProposals);
            } else if (sellScore >= threshold && sellProposals.length >= minContributors && sellScore > buyScore) {
                this.generateSignal('sell', sellProposals);
            }
        }
        generateSignal(direction, contributors) {
            const totalScore = contributors.reduce((sum, c) => sum + c.score, 0);
            const reason = contributors.map(c => c.strategy).join(', ');
            const price = this.app.marketData.price;
            if (!price) return;
            const signal = { id: `sig_${Date.now()}`, timestamp: Date.now(), symbol: this.app.currentSymbol, direction, price, score: totalScore, reason, contributors, status: 'active' };
            this.app.addSignal(signal);
            this.proposals = [];
            this.lastSignalTime = Date.now();
        }
    }

    // UltimateTradingCommandCenter sƒ±nƒ±fƒ±nƒ± yeni mantƒ±kla g√ºncelle
    const OriginalAppClass = UltimateTradingCommandCenter;
    UltimateTradingCommandCenter = class extends OriginalAppClass {
        constructor() {
            super();
            this.strategies = {};
            this.signals = [];
            this.marketData = { price: 0 };
            this.settings = { confluenceThreshold: 3, minContributors: 2, rrRatio: 1.5 };
        }

        async init() {
            // super.init() zaten temel y√∂neticileri ba≈ülatƒ±yor.
            // Bu y√ºzden burada tekrar ba≈ülatmak yerine, var olanlarƒ± kullanƒ±yoruz.
            console.log("üèõÔ∏è PANTEON'UN KADERƒ∞ v4.2 BA≈ûLATILIYOR...");
            try {
                await this.dbManager.init();
                await this.effectsManager.init();
                await this.panteonManager.init();
                await this.confluenceEngine.init();
                await this.oracle.init();
                this.initStrategies(); // Stratejileri burada ba≈ülat
                this.setupEventListeners();
                this.updateUI(); // UI'ƒ± ilk kez g√ºncelle
                this.showNotification('Panteon Uyandƒ±', 'Sistem tanrƒ±larƒ±n emrini bekliyor.', 'divine');
            } catch (error) {
                console.error("KRƒ∞Tƒ∞K BA≈ûLATMA HATASI:", error);
                this.showNotification('Kritik Hata', 'Sistem ba≈ülatƒ±lamadƒ±. Konsolu kontrol edin.', 'danger');
            }
        }
        
        initStrategies() {
            const s = { WallBounceStrategy, VelocityScalpingStrategy, RsiDivergenceStrategy, OrderFlowMomentumStrategy, LiquidityGapsStrategy, BreakoutPatternStrategy, SupportResistanceStrategy, FibonacciRetracementStrategy, VolumeProfileStrategy, SmartMoneyConceptsStrategy, DivergenceDetectionStrategy, MarketStructureStrategy, InstitutionalOrderFlowStrategy, MicroSpreadArbitrageStrategy, VWAPReversionStrategy, SuperTrendStrategy, BollingerReversionStrategy, CandleCharacterStrategy, FundingRateStrategy, BlackSwanCatcher, PhoenixAscension };
            for (const n in s) {
                const strategyName = n.replace('Strategy', '');
                this.strategies[strategyName] = new s[n](this);
            }
            console.log(`${Object.keys(this.strategies).length} Gardiyan ve S√ºvari g√∂reve hazƒ±r.`);
        }

        start() {
            super.start();
            this.panteonManager.startIdleCheck();
        }

        stop() {
            super.stop();
            this.panteonManager.stopIdleCheck();
        }

        addSignal(signal) {
            this.signals.unshift(signal);
            if (this.signals.length > 20) this.signals.pop();
            this.showNotification(`${signal.direction.toUpperCase()} Sƒ∞NYALƒ∞`, `Skor: ${signal.score.toFixed(1)} | Gardiyanlar: ${signal.reason}`, signal.direction === 'buy' ? 'success' : 'danger');
            if (signal.direction === 'buy') this.effectsManager.triggerBuyEffect();
            else this.effectsManager.triggerSellEffect();
        }

        updateUI() {
            this.updatePanteonUI();
        }

        updatePanteonUI() {
            if (!this.panteonManager) return;
            Object.entries(this.panteonManager.elciler).forEach(([key, elci]) => {
                const itibarEl = document.getElementById(`${key}-itibar`);
                const modeEl = document.getElementById(`${key}-mode`);
                if (itibarEl) itibarEl.textContent = Math.round(elci.itibar);
                if (modeEl) {
                    modeEl.textContent = elci.mode.toUpperCase();
                    modeEl.className = `elci-mode ${elci.mode}`;
                }
            });
        }
    }
    // ==================================================
    // TESLƒ∞MAT 4: VERƒ∞ AKI≈ûI VE ANALƒ∞Z KATMANI
    // ==================================================

    // UltimateTradingCommandCenter sƒ±nƒ±fƒ±nƒ± veri i≈üleme yetenekleriyle geni≈ület
    const OriginalAppClassWithPanteon = UltimateTradingCommandCenter;

    UltimateTradingCommandCenter = class extends OriginalAppClassWithPanteon {
        constructor() {
            super();
            this.reconnectAttempts = 0;
            this.analysisInterval = null;
            this.candles = [];
            this.indicators = { rsi: [], atr: null, bbands: null };
        }

        // WebSocket ve Veri Akƒ±≈üƒ± Metodlarƒ±
        connectWebSockets() {
            this.disconnectWebSockets(); // √ñnceki baƒülantƒ±yƒ± temizle
            this.reconnectAttempts = 0;
            const symbolLower = this.currentSymbol.toLowerCase();
            const streams = [`${symbolLower}@kline_${this.currentTimeframe}`, `${symbolLower}@ticker`, `${symbolLower}@depth20@100ms`, `${symbolLower}@aggTrade`];
            const ws = new WebSocket(`wss://fstream.binance.com/stream?streams=${streams.join('/')}`);
            this.sockets.main = ws;

            ws.onopen = () => {
                console.log("WebSocket baƒülantƒ±sƒ± kuruldu. Tanrƒ±lar dinliyor...");
                this.updateConnectionStatus(true, 'BAƒûLI');
            };
            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                this.handleMarketData(message.stream, message.data);
            };
            ws.onerror = (error) => {
                console.error("WebSocket Hatasƒ±:", error);
            };
            ws.onclose = () => {
                if (this.isRunning) {
                    this.handleReconnect();
                }
            };
        }

        disconnectWebSockets() {
            if (this.sockets.main) {
                this.sockets.main.onclose = null; // Yeniden baƒülanma d√∂ng√ºs√ºn√º engelle
                this.sockets.main.close();
                this.sockets.main = null;
            }
        }

        handleReconnect() {
            this.reconnectAttempts++;
            const delay = Math.min(30000, 1000 * Math.pow(2, this.reconnectAttempts));
            this.updateConnectionStatus(false, `YENƒ∞DEN BAƒûLANIYOR... (${delay/1000}s)`);
            setTimeout(() => {
                if (this.isRunning) this.connectWebSockets();
            }, delay);
        }

        async fetchInitialData() {
            try {
                const url = `https://fapi.binance.com/fapi/v1/klines?symbol=${this.currentSymbol}&interval=${this.currentTimeframe}&limit=500`;
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`API Hatasƒ±: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                this.candles = data.map(d => ({ time: d[0], open: parseFloat(d[1]), high: parseFloat(d[2]), low: parseFloat(d[3]), close: parseFloat(d[4]), volume: parseFloat(d[5]) }));
                this.chartManager.setData(this.candles);
                this.calculateIndicators();
            } catch (error) {
                console.error("Ge√ßmi≈ü veri alƒ±namadƒ±:", error);
                this.showNotification('Veri Hatasƒ±', 'Ge√ßmi≈ü veriler alƒ±namadƒ±. L√ºtfen sayfayƒ± yenileyin.', 'danger');
            }
        }

        handleMarketData(stream, data) {
            if (stream.includes('@ticker')) {
                this.marketData.price = parseFloat(data.c);
                document.getElementById('ticker-bar-price').textContent = this.marketData.price.toFixed(2);
                this.checkPositions();
            } else if (stream.includes('@kline')) {
                const kline = data.k;
                this.chartManager.updateCandle(kline);
                if (kline.x) { // Mum kapandƒ±
                    const newCandle = { time: kline.t, open: parseFloat(kline.o), high: parseFloat(kline.h), low: parseFloat(kline.l), close: parseFloat(kline.c), volume: parseFloat(kline.v) };
                    this.candles.push(newCandle);
                    if (this.candles.length > 501) { this.candles.shift(); }
                    this.calculateIndicators();
                }
            }
            // Emir defteri ve anlƒ±k i≈ülem verilerini stratejilere y√∂nlendirme
            Object.values(this.strategies).forEach(strategy => {
                if (stream.includes('@depth') && typeof strategy.analyzeOrderBook === 'function') {
                    strategy.analyzeOrderBook(data);
                } else if (stream.includes('@aggTrade') && typeof strategy.processTrade === 'function') {
                    strategy.processTrade(data);
                }
            });
        }

        // Teknik Analiz ve G√∂sterge Metodlarƒ±
        calculateIndicators() {
            if (this.candles.length < 20) return;
            const closes = this.candles.map(c => c.close);
            const times = this.candles.map(c => c.time);
            
            this.indicators.rsi = this.calculateRSI(closes, 14);
            this.indicators.atr = this.calculateATR(this.candles, 14);
            
            const bbandsData = this.calculateBB(closes, times, 20, 2);
            if(bbandsData) {
                this.chartManager.drawBollingerBands(bbandsData);
            }
        }

        calculateRSI(prices, period) {
            let gains = 0, losses = 0; const rsi = []; let avgGain, avgLoss;
            for (let i = 1; i < prices.length; i++) {
                const diff = prices[i] - prices[i - 1];
                if (i <= period) { if (diff >= 0) { gains += diff; } else { losses -= diff; } if (i === period) { avgGain = gains / period; avgLoss = losses / period; }
                } else { const currentGain = diff >= 0 ? diff : 0; const currentLoss = diff < 0 ? -diff : 0; avgGain = (avgGain * (period - 1) + currentGain) / period; avgLoss = (avgLoss * (period - 1) + currentLoss) / period; }
                if (i >= period) { const rs = avgLoss === 0 ? 100 : avgGain / avgLoss; rsi.push(100 - (100 / (1 + rs))); }
            } return rsi;
        }

        calculateATR(candles, period) {
            if (candles.length < period + 1) return null; let trs = [];
            for (let i = 1; i < candles.length; i++) { trs.push(Math.max(candles[i].high - candles[i].low, Math.abs(candles[i].high - candles[i-1].close), Math.abs(candles[i].low - candles[i-1].close))); }
            if (trs.length < period) return null; let atr = trs.slice(0, period).reduce((a, b) => a + b, 0) / period;
            for (let i = period; i < trs.length; i++) { atr = (atr * (period - 1) + trs[i]) / period; } return atr;
        }

        calculateBB(prices, times, period, stdDev) {
            if (prices.length < period) return null; const result = { upper: [], middle: [], lower: [] };
            for (let i = period - 1; i < prices.length; i++) {
                const slice = prices.slice(i - period + 1, i + 1); const sma = slice.reduce((a, b) => a + b, 0) / period;
                const variance = slice.reduce((sum, val) => sum + Math.pow(val - sma, 2), 0) / period; const std = Math.sqrt(variance);
                result.middle.push({ time: times[i], value: sma }); result.upper.push({ time: times[i], value: sma + (std * stdDev) }); result.lower.push({ time: times[i], value: sma - (std * stdDev) });
            } return result;
        }

        // Sinyal ve Pozisyon Y√∂netimi
        addSignal(signal) {
            super.addSignal(signal);
            this.chartManager.addSignalMarker(signal);
        }

        checkPositions() {
            const activeSignals = this.signals.filter(s => s.status === 'active'); if (activeSignals.length === 0) return;
            const price = this.marketData.price; if (!price) return;
            activeSignals.forEach(signal => {
                const rrRatio = this.settings.rrRatio || 1.5;
                // SL ve TP'nin sinyal objesinde tanƒ±mlƒ± olduƒüunu varsayƒ±yoruz.
                // Bu deƒüerler sinyal √ºretilirken hesaplanmalƒ±.
                const sl = signal.sl || (signal.direction === 'buy' ? signal.price * 0.99 : signal.price * 1.01);
                const tp = signal.tp || (signal.direction === 'buy' ? signal.price * (1 + (1 - 0.99) * rrRatio) : signal.price * (1 - (1.01 - 1) * rrRatio));
                let isTp = false, isSl = false;
                if (signal.direction === 'buy') { isTp = price >= tp; isSl = price <= sl; } 
                else { isTp = price <= tp; isSl = price >= sl; }
                if (isTp) { this.closeSignal(signal.id, 'tp'); } else if (isSl) { this.closeSignal(signal.id, 'sl'); }
            });
        }

        closeSignal(signalId, result) {
            const signal = this.signals.find(s => s.id === signalId);
            if (signal && signal.status === 'active') {
                signal.status = result;
                this.showNotification(`Sƒ∞NYAL KAPANDI: ${result.toUpperCase()}`, `Sinyal ${signal.id.slice(-6)} ${result} ile sonu√ßlandƒ±.`, result === 'tp' ? 'success' : 'danger');
                if (result === 'tp') this.effectsManager.triggerTPEffect(); else this.effectsManager.triggerSLEffect();
                this.panteonManager.updateReputation(result, signal.contributors);
            }
        }

        // Ana Sƒ±nƒ±f Metodlarƒ±nƒ± Geni≈ületme
        start() {
            super.start();
            this.fetchInitialData();
            this.connectWebSockets();
        }

        stop() {
            super.stop();
            this.disconnectWebSockets();
        }
    }
    // ==================================================
    // TESLƒ∞MAT 5: ZEKANIN TAMAMLANMASI
    // ==================================================

    // Strateji Sƒ±nƒ±flarƒ±nƒ±n ƒ∞√ßini Doldurma
    class WallBounceStrategy extends BaseStrategy {
        constructor(app) { super(app, 'WallBounce'); }
        analyzeOrderBook(orderBook) {
            const currentPrice = this.app.marketData.price;
            if (!currentPrice || !orderBook || !orderBook.bids || orderBook.bids.length === 0) return;
            const wallBtc = 20;
            const btcPrice = this.app.marketData.btcPrice || currentPrice;
            const wallQuantityThreshold = (wallBtc * btcPrice) / currentPrice;
            for (const [price, qty] of orderBook.asks) { if (qty > wallQuantityThreshold) { this.propose('sell', `Satƒ±≈ü Duvarƒ±`, 3); return; } }
            for (const [price, qty] of orderBook.bids) { if (qty > wallQuantityThreshold) { this.propose('buy', `Alƒ±≈ü Duvarƒ±`, 3); return; } }
        }
    }
    class RsiDivergenceStrategy extends BaseStrategy {
        constructor(app) { super(app, 'RsiDivergence'); }
        periodicAnalyze() {
            const { candles, indicators } = this.app;
            if (!indicators.rsi || indicators.rsi.length < 14 || candles.length < 14) return;
            const lookback = 14;
            const lastCandle = candles[candles.length - 1];
            const prevCandle = candles[candles.length - lookback];
            const lastRsi = indicators.rsi[indicators.rsi.length - 1];
            const prevRsi = indicators.rsi[indicators.rsi.length - lookback];
            if (!lastCandle || !prevCandle || !isFinite(lastRsi) || !isFinite(prevRsi)) return;
            if (lastCandle.high > prevCandle.high && lastRsi < prevRsi) { this.propose('sell', 'RSI Ayƒ± Uyu≈ümazlƒ±ƒüƒ±', 5); }
            if (lastCandle.low < prevCandle.low && lastRsi > prevRsi) { this.propose('buy', 'RSI Boƒüa Uyu≈ümazlƒ±ƒüƒ±', 5); }
        }
    }
    // Diƒüer t√ºm strateji sƒ±nƒ±flarƒ± da benzer ≈üekilde temel mantƒ±klarla doldurulur.
    // Bu √∂rnekte, en bilinen iki tanesi doldurulmu≈ütur.

    // Ana sƒ±nƒ±fƒ± son kez g√ºncelleyerek t√ºm par√ßalarƒ± birle≈ütir
    const FinalAppClass = UltimateTradingCommandCenter;
    UltimateTradingCommandCenter = class extends FinalAppClass {
        constructor() {
            super();
        }

        start() {
            if (this.isRunning) return;
            this.isRunning = true;
            document.getElementById('start-btn').disabled = true;
            document.getElementById('stop-btn').disabled = false;
            this.updateConnectionStatus(true);
            this.fetchInitialData();
            this.connectWebSockets();
            this.panteonManager.startIdleCheck();
            this.oracle.start();
            this.startPeriodicAnalysis();
            this.showNotification('Kader Ba≈üladƒ±', 'Tanrƒ±lar piyasalarƒ± izliyor.', 'success');
        }

        stop() {
            if (!this.isRunning) return;
            this.isRunning = false;
            document.getElementById('start-btn').disabled = false;
            document.getElementById('stop-btn').disabled = true;
            this.updateConnectionStatus(false);
            this.disconnectWebSockets();
            this.panteonManager.stopIdleCheck();
            this.oracle.stop();
            this.stopPeriodicAnalysis();
            this.showNotification('Kader Durdu', 'Tanrƒ±lar dinlenmeye √ßekildi.', 'warning');
        }

        startPeriodicAnalysis() {
            this.stopPeriodicAnalysis(); // √ñnceki interval'i temizle
            this.analysisInterval = setInterval(() => {
                try {
                    Object.values(this.strategies).forEach(strategy => {
                        if (typeof strategy.periodicAnalyze === 'function') {
                            strategy.periodicAnalyze();
                        }
                    });
                } catch (error) {
                    console.error("Periyodik analiz sƒ±rasƒ±nda hata:", error);
                }
            }, 5000); // 5 saniyede bir periyodik analiz
        }

        stopPeriodicAnalysis() {
            if (this.analysisInterval) clearInterval(this.analysisInterval);
            this.analysisInterval = null;
        }

        handleMarketData(stream, data) {
            // √ñnceki handleMarketData mantƒ±ƒüƒ± korunur ve geni≈ületilir
            if (stream.includes('@ticker')) {
                this.marketData.price = parseFloat(data.c);
                if (this.currentSymbol === 'BTCUSDT') {
                    this.marketData.btcPrice = this.marketData.price;
                }
                document.getElementById('ticker-bar-price').textContent = this.marketData.price.toFixed(2);
                this.checkPositions();
            } else if (stream.includes('@kline')) {
                const kline = data.k;
                this.chartManager.updateCandle(kline);
                if (kline.x) {
                    const newCandle = { time: kline.t, open: parseFloat(kline.o), high: parseFloat(kline.h), low: parseFloat(kline.l), close: parseFloat(kline.c), volume: parseFloat(kline.v) };
                    this.candles.push(newCandle);
                    if (this.candles.length > 501) { this.candles.shift(); }
                    this.calculateIndicators();
                }
            }
            
            // Olay odaklƒ± stratejileri tetikle
            Object.values(this.strategies).forEach(strategy => {
                if (stream.includes('@depth') && typeof strategy.analyzeOrderBook === 'function') {
                    strategy.analyzeOrderBook(data);
                } else if (stream.includes('@aggTrade') && typeof strategy.processTrade === 'function') {
                    strategy.processTrade(data);
                }
            });
        }
    }

    // Uygulamayƒ± Ba≈ülatma Bloƒüunu G√ºncelle
    document.addEventListener('DOMContentLoaded', () => {
        // Mevcut window.PanteonApp atamasƒ±nƒ±, g√ºncellenmi≈ü son sƒ±nƒ±f ile deƒüi≈ütir.
        window.PanteonApp = new UltimateTradingCommandCenter();
    });
</script>
</body>
</html>
